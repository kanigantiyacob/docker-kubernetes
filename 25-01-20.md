# Docker  Control   Groups
* Memory,
* CPU,
* Disk I/O(Volumes),
* Network,
* etc


>By default, a container has no resource constraints (restrictions) 
and it can use as much of a given resource of  the host’s kernel scheduler allows. 

>But, We can  control (restrictions) memory , CPU, disk , network  for a container by cgroups while Create a container by using  “docker run” command.



## support swap limit capabilities or the cgroup:
* Edit the vi  /etc/default/grub
* add the following two key-value pairs:
* GRUB_CMDLINE_LINUX="cgroup_enable=memory swapaccount=1"
* sudo update-grub
* sudo reboot



# Memory
* There are two basic types of memory
## first type of memory are RAM and HD:

> Random access memory (RAM), is used to store data and very speed I/O, RAM is volatile memory,the data stored in RAM is lost if the server is turned off.

>Hard drives are magnetic media used for long-term storage of data and programs. Magnetic media is nonvolatile; the data stored on a disk remains even when power off. 


## Second type of memory is Swap. 

> The primary function of swap space is to substitute disk space for RAM memory when real RAM fills up and more space is needed.
The total amount of memory in a Linux computer is the RAM plus swap space and is referred to as virtual memory.
Total memory =   ram +  swap
Totlal memory is 6gb = ram 2gb+ swap 4gb

## We can  control  memory by below options

```
1) -m or --memory= 
it represents, The maximum amount of memory the container can use, min 4mb

Ex1: To set memory limit only, container can use 300M memory,  swap memory 600M

# docker run --name c1 -m 300M -d -p 8081:8080 tomcat
# docker stats
# docker inspect c1

2) --memory-swap*
it represents the total amount of memory and swap also

Ex2: set memory limit, disabled swap memory limit,  container can use 300M memory,  as much swap memory as need

# docker run --name c1 -m 300M --memory-swap -1  -d -p 8081:8080 tomcat 
# docker run --name c1 -m 300M --memory-swap 700M  -d -p 8081:8080 tomcat
# docker stats
# docker  inspect c1


3) --memory-reservation
it request additional memory, after hitting in to memory limit,to preventing service outages

hard limit    :  It is  actual RAM memory (300M)
soft limit     : It is  additional memory (100M)

 Exp:To sets a hard limit, the container be allowed to use more than 300MB of RAM. Alternatively, we could set a soft limit. It is request to additional memory Soft limits ensure our container can still request additional memory of 100MB  after hitting its limit 300MB, to preventing service outages

# docker run --name c1 -m 300M --memory-reservation 100M  -d -p 8081:8080 tomcat 
# docker stats
# docker  inspect c1


```


## We can  control   CPU by below options

```
1) --cpus=<value>  :
we can specify how much of the available CPU resources a container can use.
For instance, if the host machine has two CPUs and you set --cpus="0.25",
specifies the percentage of available CPU resources a container can use

# docker run --name c1 -m 300M --memory-reservation 100M --cpus=0.25 -d -p 8081:8080 tomcat 

2) --cpuset-cpus  :
Limit the specific CPUs or cores a container can use,On a 4 core host machine we can specify 0-3. We can specify a single core or even multiple cores

# docker run --name c1 -m 300M --memory-reservation 100M --cpuset-cpus=0 -d -p 8081:8080 tomcat


```


## DISK (volumes)


> Volumes are the preferred mechanism for persisting data generated by and used by Docker containers.While bind mounts are dependent on the directory structure of the host machine, volumes are completely managed by Docker. Volumes have several advantages:

* Volumes are easier to back up or migrate than bind mounts.
* You can manage volumes using Docker CLI commands or the Docker API.
* Volumes can be more safely shared among multiple containers.
* To keep data around when a container is removed
* To share data between the host filesystem and the Docker container



## Linux capabilities in Docker

> Docker gives by default below list of capabilities available to privileged processes in a docker container:

```
chown,Dac_override,fowner, fsetid,kill, setgid, setuid, Setpcap, net_bind_service,net_raw, sys_chroot, mknod,audit_write, setfcap
```


```
While creating a container, we can adjust capabilities  with below options

--cap-drop
--cap-add 

The best policy is to drop all capabilities a container's privileges 
For security.

  --cap-drop=ALL
Ex: # docker run --name c1 --cap-drop=ALL -d -p 8081:8080 tomcat
    # docker run --name c1 --cap-drop=chown  -d -p 8081:8080 tomcat

We can add back individual capabilities, if needed with 

--cap-add=CHOWN

Ex: # docker run --name c1 --cap-add=chown  -d -p 8081:8080 tomcat
    # docker run --name c1 --cap-drop=ALL --cap-add=chown  -d -p 8081:8080 tomcat


Note:  If drops capabilities before starting a container, inside a  container can not get them back.

```
# Runtime privilege


* By default, Docker containers are “unprivileged” 
* By default a container is not allowed to access any devices(disk), 
* But if we give  a “privileged” to container is given access to for all devices(all  disks).
* When executes  “docker run --privileged”, Docker will enable access to all devices on the host as well as set some configuration.
* If you want to access to a specific device or devices you can use the --device flag. It allows you to specify one or more devices that will be accessible within the container By  “docker run --device=/dev/snd”


```
Exp: For All devices
# docker run --name c1 --privileged --cap-add=ALL -d -p 8081:8080 tomcat


Exp:  For specific device
# docker run --name c2 --cap-add=ALL --device=/dev/xvdf -d -p 8082:8080 tomcat


```


# docker network

```
#docker network create -d bridge --subnet 10.10.0.0/24  maha-bridge
#docker network ls

#docker run  --name c1 --network mahanw -d -p 8081:8080 tomcat
#docker run  --name c2 --network mahanw -d -p 8082:8080 tomcat 

```










